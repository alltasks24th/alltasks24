<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>คำนวณราคา PRO+ ใบเสร็จ — Alltasks24</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#F7F5FF; --card:#FFF; --ink:#0F172A; --muted:#475569; --primary:#6D28D9; --accent:#4338CA; --soft:#EDE9FE; --border:#E9E7FF; }
    body{ background:var(--bg); color:var(--ink); font-family:"Kanit",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans Thai","Sarabun",sans-serif; }
    .container-narrow{ max-width:1200px }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; box-shadow:0 6px 20px rgba(17,12,46,.05) }
    .eyebrow{ font-size:.85rem; letter-spacing:.04em; color:var(--muted); text-transform:uppercase }
    .pill{ border:1px dashed var(--border); padding:.25rem .6rem; border-radius:2rem; color:var(--muted) }
    .btn-primary{ background:var(--primary); border-color:var(--primary) }
    .btn-outline-primary{ color:var(--accent); border-color:var(--accent) }
    .btn-outline-primary:hover{ background:var(--soft) }
    .result-big{ font-size:2rem; color:var(--accent) }
    .list-breakdown div{ display:flex; justify-content:space-between; border-bottom:1px dashed var(--border); padding:.25rem 0 }
    .table-receipt thead th{ background:var(--soft) }
    @media print{ .no-print{display:none!important}; body{background:#fff} .card{border:none; box-shadow:none} }
  </style>
</head>
<body>
  <div class="container container-narrow my-3 my-md-4">

    <div class="card p-3 p-md-4 mb-3">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="h6 mb-0">ตั้งค่าสูตรราคา</div>
          <div class="small text-secondary">ขั้นบันได + ขั้นต่ำ + ปัดเศษ</div>
        </div>
        <div class="pill small">โปรไฟล์สูตร</div>
      </div>

      <hr>
      <div class="row g-2">
        <div class="col-6"><label class="form-label">ฐานในเมือง (บาท)</label><input id="cfg_base" type="number" class="form-control" value="59"></div>
        <div class="col-6"><label class="form-label">ระยะรวมในฐาน (กม.)</label><input id="cfg_incKm" type="number" class="form-control" value="3"></div>
        <div class="col-6"><label class="form-label">เกินระยะ/กม. (ชั้น 1)</label><input id="cfg_perKm1" type="number" class="form-control" value="8"></div>
        <div class="col-6"><label class="form-label">เริ่มชั้น 2 ที่ (กม.)</label><input id="cfg_tier2Start" type="number" class="form-control" value="15"></div>
        <div class="col-6"><label class="form-label">เกินระยะ/กม. (ชั้น 2)</label><input id="cfg_perKm2" type="number" class="form-control" value="6"></div>
        <div class="col-6"><label class="form-label">ขั้นต่ำค่าบริการ</label><input id="cfg_minCharge" type="number" class="form-control" value="49"></div>
        <div class="col-6"><label class="form-label">ค่าจุดแวะ/จุด</label><input id="cfg_stop" type="number" class="form-control" value="10"></div>
        <div class="col-6"><label class="form-label">รอคิว/ชม.</label><input id="cfg_wait" type="number" class="form-control" value="100"></div>
        <div class="col-6"><label class="form-label">กลางคืน (บาท)</label><input id="cfg_night" type="number" class="form-control" value="10"></div>
        <div class="col-6"><label class="form-label">ฝนตก (บาท)</label><input id="cfg_rain" type="number" class="form-control" value="8"></div>
        <div class="col-6"><label class="form-label">เสาร์–อาทิตย์/นักขัต</label><input id="cfg_weekend" type="number" class="form-control" value="10"></div>
        <div class="col-6"><label class="form-label">ปัดเศษ (บาท)</label>
          <select id="cfg_roundTo" class="form-select">
            <option value="1" selected>ไม่ปัด</option><option value="5">ขั้นละ 5</option><option value="10">ขั้นละ 10</option>
          </select>
        </div>
        <div class="col-6"><label class="form-label">คูณขนาด: กลาง</label><input id="cfg_multSize" type="number" class="form-control" step="0.01" value="1.05"></div>
        <div class="col-6"><label class="form-label">คูณแรงงาน: 2 คน</label><input id="cfg_multLabor" type="number" class="form-control" step="0.01" value="1.30"></div>
        <div class="col-6"><label class="form-label">เพดานระยะ (กม.)</label><input id="cfg_maxKm" type="number" class="form-control" value="25"></div>
        <div class="col-6"><label class="form-label">เพดานน้ำหนัก (กก.)</label><input id="cfg_maxW" type="number" class="form-control" value="12"></div>
      </div>

      <div class="d-flex gap-2 mt-3">
        <button id="btnSaveCfg" class="btn btn-primary"><i class="bi bi-save me-1"></i>บันทึกสูตร</button>
        <button id="btnResetCfg" class="btn btn-outline-primary">รีเซ็ตค่าเริ่มต้น</button>
      </div>

      <hr class="my-4">
      <div class="h6">ข้อมูลร้าน & สื่อ</div>
      <div class="row g-2">
        <div class="col-12"><label class="form-label">ชื่อร้าน/ผู้ให้บริการ</label><input id="biz_name" class="form-control" value="alltasks24 — นครสวรรค์"></div>
        <div class="col-6"><label class="form-label">โทร</label><input id="biz_phone" class="form-control" value="080-000-0000"></div>
        <div class="col-6"><label class="form-label">LINE/Facebook</label><input id="biz_line" class="form-control" value="@yourline"></div>
        <div class="col-12"><label class="form-label">ที่อยู่/บันทึกย่อ</label><input id="biz_addr" class="form-control" placeholder="เช่น ตัวเมืองนครสวรรค์"></div>
        <div class="col-6"><label class="form-label">วิธีชำระเงิน (ค่าเริ่มต้น)</label>
          <select id="biz_pay" class="form-select"><option value="เงินสด" selected>เงินสด</option><option value="โอน">โอน</option><option value="PromptPay">PromptPay</option></select>
        </div>
        <div class="col-6"><label class="form-label">หมายเหตุท้ายใบเสร็จ</label><input id="biz_note" class="form-control" value="ขอบคุณที่ใช้บริการ"></div>
        <div class="col-6"><label class="form-label">โลโก้ (URL)</label><input id="biz_logo" class="form-control" placeholder="https://..."></div>
        <div class="col-6"><label class="form-label">QR/พร้อมเพย์ (URL)</label><input id="biz_qr" class="form-control" placeholder="https://..."></div>
      </div>
      <div class="d-flex gap-2 mt-3">
        <button id="btnSaveBiz" class="btn btn-primary"><i class="bi bi-save me-1"></i>บันทึกข้อมูลร้าน</button>
      </div>

      <hr class="my-4">
      <div class="d-flex align-items-center justify-content-between">
        <div class="eyebrow">คลังบิล/ใบเสร็จ</div>
        <span class="pill small">ค้นหา • ลบ • แบ่งหน้า</span>
      </div>
      <div class="d-flex gap-2 my-2">
        <input id="invSearch" class="form-control form-control-sm" placeholder="ค้นหา (ลูกค้า/เลขบิล/งาน)">
        <select id="invFilter" class="form-select form-select-sm" style="width:auto">
          <option value="all">ทั้งหมด</option><option value="paid">ชำระแล้ว</option><option value="unpaid">ค้างชำระ</option>
        </select>
      </div>
      <div id="invList" class="vstack gap-2"></div>
      <nav class="mt-2" aria-label="pagination"><ul id="invPager" class="pagination pagination-sm mb-0"></ul></nav>
    </div>

    <div class="card p-3 p-md-4 mb-3">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <div class="h6 mb-0">คำนวณราคา</div>
          <div class="small text-secondary">พิมพ์ประเภทงานเอง + ระยะทางไป-กลับ + ปัดเศษ + ขั้นต่ำ</div>
        </div>
        <div><button id="btnCopySummary" class="btn btn-outline-secondary btn-sm">คัดลอกสรุป</button></div>
      </div>

      <div class="row g-3 mt-1">
        <div class="col-md-7"><label class="form-label">ประเภทงาน</label><input id="jobName" class="form-control" placeholder="เช่น ฝากซื้อของ/ส่งพัสดุ/เอกสาร"></div>
        <div class="col-md-5"><label class="form-label">ค่าสินค้าตามจริง (ถ้ามี)</label><input id="otherCost" type="number" class="form-control" value="0"></div>
        <div class="col-md-3"><label class="form-label">ระยะทาง (กม.)</label><input id="km" type="number" class="form-control" step="0.1"><div class="form-text"><a id="openMaps" href="#" target="_blank">วัดระยะบน Google Maps</a></div></div>
        <div class="col-md-3"><label class="form-label">ไป-กลับ?</label><select id="roundtrip" class="form-select"><option value="no" selected>เที่ยวเดียว</option><option value="yes">ไป-กลับ (×2)</option></select></div>
        <div class="col-md-3"><label class="form-label">จุดแวะ (จุด)</label><input id="stops" type="number" class="form-control" value="0"></div>
        <div class="col-md-3"><label class="form-label">รอคิว (นาที)</label><input id="wait" type="number" class="form-control" step="5" value="0"><div class="form-text">ปัดขึ้นทุก 15 นาที</div></div>
        <div class="col-md-3"><label class="form-label">ขนาด</label><select id="size" class="form-select"><option value="small">เล็ก (≤5 กก.)</option><option value="medium" selected>กลาง (≤10–12 กก.)</option></select></div>
        <div class="col-md-3"><label class="form-label">คนทำงาน</label><select id="workers" class="form-select"><option value="1" selected>1 คน</option><option value="2">2 คน</option></select></div>
        <div class="col-md-3"><label class="form-label d-block">เงื่อนไข</label>
          <div class="form-check form-check-inline"><input id="night" class="form-check-input" type="checkbox"><label class="form-check-label" for="night">กลางคืน</label></div>
          <div class="form-check form-check-inline"><input id="rain" class="form-check-input" type="checkbox"><label class="form-check-label" for="rain">ฝนตก</label></div>
          <div class="form-check form-check-inline"><input id="weekend" class="form-check-input" type="checkbox"><label class="form-check-label" for="weekend">เสาร์–อาทิตย์/นักขัต</label></div>
        </div>
        <div class="col-md-3"><label class="form-label">ส่วนลด (บาท)</label><input id="discount" type="number" class="form-control" value="0"></div>
        <div class="col-md-3"><label class="form-label">VAT</label><select id="vat" class="form-select"><option value="no" selected>ไม่คิด VAT</option><option value="yes">คิด VAT 7%</option></select></div>
      </div>

      <div id="alertBox" class="alert alert-warning d-none mt-3 mb-0"></div>

      <div id="resultBox" class="mt-3">
        <div class="result-big fw-bold" id="grandLabel">฿0</div>
        <div class="list-breakdown mt-2 small" id="breakdownBox"></div>
        <div class="small text-secondary mt-2">* ราคาโดยประมาณ อาจเปลี่ยนตามระยะจริง/สภาพจราจร/อากาศ</div>
      </div>

      <div class="d-flex gap-2 mt-3">
        <button id="btnCreateReceipt" class="btn btn-primary"><i class="bi bi-receipt me-1"></i>สร้างใบเสร็จ</button>
        <button id="btnClear" class="btn btn-outline-secondary">ล้างค่า</button>
      </div>

      <div id="summaryBar" class="no-print mt-3 d-flex align-items-center justify-content-between">
        <div class="fw-bold">รวม: <span id="grandSummary">฿0</span></div>
        <div class="d-flex gap-2">
          <button id="summaryCreate" class="btn btn-primary btn-sm">สร้างใบเสร็จ</button>
          <button id="summaryPrint" class="btn btn-outline-secondary btn-sm">พิมพ์</button>
        </div>
      </div>
    </div>

    <div class="card p-3 p-md-4 mb-5">
      <div class="d-flex align-items-center justify-content-between">
        <div class="h6 mb-0">ใบเสร็จ/บิล</div>
        <div class="d-flex gap-2"><button id="btnAddRow" class="btn btn-outline-secondary btn-sm">เพิ่มบรรทัด</button><button id="btnSaveBill" class="btn btn-primary btn-sm">บันทึก/อัปเดตบิล</button><button id="btnNewBill" class="btn btn-outline-secondary btn-sm">สร้างใหม่</button><button id="btnPrint" class="btn btn-outline-primary btn-sm">พิมพ์/PDF</button></div>
      </div>

      <section id="receipt" class="receipt p-3 p-md-4 mt-3 border rounded">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <div class="fw-bold">ใบเสร็จ/บิลรับงาน</div>
            <div class="small text-secondary">สร้างจากเครื่องมือคำนวณราคา</div>
          </div>
          <div class="text-end">
            <div class="fw-semibold" id="bizNameView">alltasks24 — นครสวรรค์</div>
            <div class="small" id="bizContactView">โทร 080-000-0000 • LINE @yourline</div>
            <div class="small" id="bizAddrView"></div>
          </div>
        </div>

        <div class="row g-2 mt-2">
          <div class="col-md-6"><div class="small text-secondary">ลูกค้า</div><input id="cust_name" class="form-control form-control-sm" placeholder="ชื่อลูกค้า/หน่วยงาน"></div>
          <div class="col-md-3"><div class="small text-secondary">เบอร์โทร</div><input id="cust_phone" class="form-control form-control-sm" placeholder="080-xxx-xxxx"></div>
          <div class="col-md-3"><div class="small text-secondary">เลขที่ใบเสร็จ</div><input id="inv_no" class="form-control form-control-sm" readonly></div>
        </div>

        <div class="row g-2 mt-1">
          <div class="col-md-6"><div class="small text-secondary">ที่อยู่ลูกค้า</div><input id="cust_addr" class="form-control form-control-sm"></div>
          <div class="col-md-3"><div class="small text-secondary">เลขผู้เสียภาษี</div><input id="cust_taxid" class="form-control form-control-sm" placeholder="(ถ้ามี)"></div>
          <div class="col-md-3"><div class="small text-secondary">วันที่/เวลา</div><div class="d-flex gap-1"><input id="inv_date" class="form-control form-control-sm"><input id="inv_time" class="form-control form-control-sm"></div></div>
        </div>

        <div class="row g-2 mt-1">
          <div class="col-md-9"><div class="small text-secondary">งาน/รายละเอียด</div><input id="inv_job" class="form-control form-control-sm" placeholder="เช่น ฝากซื้อของ/ส่งพัสดุ"></div>
          <div class="col-md-3"><div class="small text-secondary">หมายเหตุในบิล</div><input id="inv_note" class="form-control form-control-sm" placeholder="(ถ้ามี)"></div>
        </div>

        <div class="table-responsive mt-3">
          <table class="table table-receipt align-middle" id="rc_table">
            <thead><tr><th style="width:45%">รายการ</th><th class="text-center" style="width:10%">จำนวน</th><th class="text-center" style="width:12%">หน่วย</th><th class="text-end" style="width:16%">ราคา/หน่วย</th><th class="text-end" style="width:17%">จำนวนเงิน</th></tr></thead>
            <tbody id="rc_items"><tr><td class="text-muted" colspan="5">— กด “สร้างใบเสร็จ” เพื่อใส่รายการอัตโนมัติ หรือ “เพิ่มบรรทัด” เพื่อใส่เอง —</td></tr></tbody>
            <tfoot>
              <tr><th class="text-end" colspan="4">ค่าสินค้าตามจริง</th><th class="text-end" id="rc_other" data-val="0">฿0</th></tr>
              <tr><th class="text-end" colspan="4">ส่วนลด</th><th class="text-end" id="rc_discount" data-val="0">฿0</th></tr>
              <tr><th class="text-end" colspan="4">Vat 7%</th><th class="text-end" id="rc_vat" data-val="0">฿0</th></tr>
              <tr><th class="text-end" colspan="4">รวมทั้งสิ้น</th><th class="text-end" id="rc_total" style="font-size:1.2rem">฿0</th></tr>
            </tfoot>
          </table>
        </div>

        <div class="row g-2 mt-2">
          <div class="col-md-3"><div class="small text-secondary">วิธีชำระเงิน</div><input id="pay_method" class="form-control form-control-sm" value="เงินสด"></div>
          <div class="col-md-3"><div class="small text-secondary">สถานะ</div><select id="pay_status" class="form-select form-select-sm"><option value="ค้างชำระ">ค้างชำระ</option><option value="ชำระแล้ว" selected>ชำระแล้ว</option></select></div>
          <div class="col-md-3"><div class="small text-secondary">เลขอ้างอิงชำระ</div><input id="pay_ref" class="form-control form-control-sm" placeholder="เช่น TX1234"></div>
          <div class="col-md-3"><div class="small text-secondary">กำหนดชำระ</div><input id="pay_due" type="date" class="form-control form-control-sm"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- ไม่ใส่สคริปต์ inline เพื่อผ่าน CSP -->
  <script defer src="pricing-pro-plus.js"></script>
</body>
</html>
